<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Free Web Walkie Talkie</title>

<!-- PeerJS -->
<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

<style>
  body {
    background:#0f172a;
    color:white;
    font-family: Arial;
    text-align:center;
    padding-top:40px;
  }
  input {
    padding:10px;
    width:240px;
    border-radius:8px;
    border:none;
  }
  button {
    padding:15px 25px;
    font-size:18px;
    border-radius:50px;
    border:none;
    margin-top:15px;
    background:#22c55e;
    cursor:pointer;
  }
  button:active {
    background:red;
    color:white;
  }
</style>
</head>

<body>

<h2>ðŸŽ™ Free Web Walkie-Talkie</h2>

<p>Your ID:</p>
<h3 id="myId">Generating...</h3>

<input id="peerId" placeholder="Enter other ID">
<br>
<button onclick="connect()">ðŸ”— Connect</button>

<h3>Hold button to talk</h3>
<button id="talk">ðŸŽ¤ TALK</button>

<audio id="remoteAudio" autoplay></audio>

<script>
let peer = new Peer();
let conn;
let call;
let stream;

peer.on("open", id => {
  document.getElementById("myId").innerText = id;
});

async function getMic() {
  if (!stream) {
    stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  }
  return stream;
}

peer.on("call", async incomingCall => {
  const mic = await getMic();
  incomingCall.answer(mic);
  incomingCall.on("stream", remoteStream => {
    document.getElementById("remoteAudio").srcObject = remoteStream;
  });
});

async function connect() {
  const otherId = document.getElementById("peerId").value;
  const mic = await getMic();
  call = peer.call(otherId, mic);
  call.on("stream", remoteStream => {
    document.getElementById("remoteAudio").srcObject = remoteStream;
  });
}

const talkBtn = document.getElementById("talk");

talkBtn.addEventListener("mousedown", () => {
  if (stream) stream.getAudioTracks()[0].enabled = true;
});

talkBtn.addEventListener("mouseup", () => {
  if (stream) stream.getAudioTracks()[0].enabled = false;
});
</script>

</body>
</html>
