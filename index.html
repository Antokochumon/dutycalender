<!DOCTYPE html>
<html lang="en">
<head>

 

  
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#3b82f6">
  <meta name="description" content="Professional Duty Calendar App - Advanced scheduling with smart reminders">
  <title>Duty Calendar 2025</title>
  <!-- Add jsPDF library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style>
    :root {
      --primary: #3b82f6;
      --secondary: #10b981;
      --danger: #ef4444;
      --success: #22c55e;
      --warning: #f59e0b;
      --current-red: #dc2626;
      --bg-primary: #f8fafc;
      --bg-secondary: #ffffff;
      --bg-tertiary: #f1f5f9;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --border-light: #e2e8f0;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    .dark {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-tertiary: #334155;
      --text-primary: #f8fafc;
      --text-secondary: #cbd5e1;
      --border-light: #334155;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      min-height: 100vh;
      padding: 8px;
      overflow-x: hidden;
      transition: all 0.3s ease;
    }

    .container {
      max-width: 100%;
      margin: 0 auto;
    }

    /* Header */
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      background: var(--bg-secondary);
      padding: 16px;
      border-radius: 12px;
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow-sm);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .logo-icon img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 8px;
    }

    .logo-text h1 {
      font-size: 20px;
      font-weight: 800;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .logo-text .subtitle {
      color: var(--text-secondary);
      font-size: 12px;
      font-weight: 500;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .theme-toggle {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border-light);
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: none;
      align-items: center;
      gap: 6px;
    }

    .theme-toggle:hover {
      background: var(--bg-primary);
      transform: translateY(-1px);
    }

    .menu-toggle {
      background: var(--primary);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 8px;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: var(--shadow-sm);
    }

    .menu-toggle:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    /* Mobile Menu */
    .mobile-menu {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .mobile-menu.active {
      display: block;
      opacity: 1;
    }

    .mobile-menu-content {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-light);
      box-shadow: var(--shadow-lg);
      padding: 20px;
      transform: translateY(-100%);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(10px);
      max-height: 90vh;
      overflow-y: auto;
    }

    .mobile-menu.active .mobile-menu-content {
      transform: translateY(0);
    }

    .mobile-menu-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border-light);
    }

    .mobile-menu-title {
      font-size: 18px;
      font-weight: 600;
    }

    .close-menu {
      background: none;
      border: none;
      font-size: 24px;
      color: var(--text-secondary);
      cursor: pointer;
      padding: 8px;
      border-radius: 4px;
      transition: all 0.2s ease;
    }

    .close-menu:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    /* Stats Grid - Smaller size */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-bottom: 16px;
    }

    .stat-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-light);
      border-radius: 10px;
      padding: 12px;
      text-align: center;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
    }

    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .stat-number {
      font-size: 18px;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 2px;
      line-height: 1;
    }

    .stat-label {
      font-size: 9px;
      color: var(--text-secondary);
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    /* Cards */
    .card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-light);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: var(--shadow-sm);
      transition: all 0.2s ease;
    }

    .card:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-1px);
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .card-icon {
      font-size: 20px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
    }

    .card-description {
      color: var(--text-secondary);
      font-size: 14px;
      margin-top: 2px;
    }

    /* Form Elements */
    .form-group {
      margin-bottom: 16px;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    label {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      font-weight: 500;
      font-size: 14px;
    }

    input, select, textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border-light);
      border-radius: 8px;
      background: var(--bg-primary);
      color: var(--text-primary);
      font-size: 14px;
      font-family: inherit;
      transition: all 0.2s ease;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      background: var(--bg-secondary);
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 16px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      min-height: 44px;
      box-shadow: var(--shadow-sm);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover:not(:disabled) {
      background: #2563eb;
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .btn-secondary {
      background: var(--secondary);
      color: white;
    }

    .btn-secondary:hover:not(:disabled) {
      background: #059669;
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-danger:hover:not(:disabled) {
      background: #dc2626;
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .btn-outline {
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--border-light);
    }

    .btn-outline:hover:not(:disabled) {
      background: var(--bg-tertiary);
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    /* Desktop Actions */
    .desktop-actions {
      display: none;
      gap: 12px;
      margin-top: 16px;
    }

    /* Mobile Actions */
    .mobile-actions {
      display: flex;
      gap: 12px;
      margin-top: 16px;
    }

    .mobile-actions .btn {
      flex: 1;
    }

    .menu-actions {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 20px;
    }

    .menu-actions .btn {
      width: 100%;
      justify-content: flex-start;
    }

    /* Switch Component */
    .switch-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding: 12px;
      background: var(--bg-tertiary);
      border-radius: 8px;
      margin-bottom: 12px;
    }

    .switch-info {
      flex: 1;
    }

    .switch-title {
      font-weight: 500;
      font-size: 14px;
      margin-bottom: 2px;
    }

    .switch-description {
      font-size: 12px;
      color: var(--text-secondary);
    }

    .switch {
      position: relative;
      width: 44px;
      height: 24px;
      flex-shrink: 0;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .switch-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: #ccc;
      transition: 0.3s;
      border-radius: 12px;
    }

    .switch-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background: white;
      transition: 0.3s;
      border-radius: 50%;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    input:checked + .switch-slider {
      background: var(--primary);
    }

    input:checked + .switch-slider:before {
      transform: translateX(20px);
    }

    /* Calendar - Increased height and spacing */
    .calendar-container {
      margin-top: 16px;
    }

    .calendar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      padding: 0 4px;
    }

    .calendar-nav-btn {
      background: var(--bg-secondary);
      border: 1px solid var(--border-light);
      color: var(--text-primary);
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 16px;
      font-weight: 600;
    }

    .calendar-nav-btn:hover {
      background: var(--bg-tertiary);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    .calendar-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--primary);
      text-align: center;
      flex: 1;
      margin: 0 12px;
    }

    /* Calendar Grid with better spacing */
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      background: var(--bg-secondary);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid var(--border-light);
      min-height: 420px;
    }

    .calendar-day-name {
      font-weight: 600;
      font-size: 12px;
      text-align: center;
      padding: 12px 0;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .calendar-date {
      background: var(--bg-primary);
      border: 1px solid var(--border-light);
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      font-weight: 500;
      min-height: 55px;
      font-size: 14px;
      margin: 2px;
    }

    .calendar-date:hover {
      background: var(--bg-tertiary);
      transform: scale(1.02);
      box-shadow: var(--shadow-sm);
    }

    .calendar-date.other-month {
      opacity: 0.3;
      pointer-events: none;
    }

    /* Enhanced Current Date and Duty Styling */
    .calendar-date.today {
      border-color: var(--current-red);
      font-weight: 700;
    }

    .calendar-date.today .date-number {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 30px;
      height: 30px;
      background: var(--current-red);
      color: white;
      border-radius: 50%;
    }

    .calendar-date.duty {
      background: rgba(34, 197, 94, 0.1);
      border-color: var(--success);
    }

    /* Today with duty: green background, red number */
    .calendar-date.duty.today {
      background: rgba(34, 197, 94, 0.2);
      border-color: var(--success);
    }

    .calendar-date.duty.today .date-number {
      background: var(--success);
      color: var(--current-red);
      font-weight: 700;
    }

    /* Remove the selected class functionality */
    .date-number {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 30px;
      height: 30px;
    }

    .duty-time {
      font-size: 10px;
      font-weight: 400;
      margin-top: 3px;
      opacity: 0.9;
      background: rgba(34, 197, 94, 0.2);
      padding: 2px 4px;
      border-radius: 3px;
      line-height: 1;
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 10px;
      left: 10px;
      right: 10px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-light);
      border-radius: 12px;
      padding: 16px;
      box-shadow: var(--shadow-lg);
      z-index: 2000;
      transform: translateY(-100px);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(10px);
    }

    .notification.show {
      transform: translateY(0);
    }

    .notification.success {
      border-left: 4px solid var(--success);
    }

    .notification.error {
      border-left: 4px solid var(--danger);
    }

    .notification.warning {
      border-left: 4px solid var(--warning);
    }

    .notification.info {
      border-left: 4px solid var(--primary);
    }

    /* Animations */
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fade-in {
      animation: fadeInUp 0.6s ease-out;
    }

    /* Hidden elements for mobile */
    .desktop-only {
      display: none;
    }

    /* Responsive */
    @media (max-width: 480px) {
      body {
        padding: 6px;
      }
      
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
        gap: 6px;
      }
      
      .stat-card {
        padding: 8px;
      }
      
      .stat-number {
        font-size: 14px;
      }
      
      .stat-label {
        font-size: 8px;
      }
      
      .calendar-date {
        min-height: 50px;
        font-size: 13px;
        margin: 1px;
      }
      
      .calendar-grid {
        gap: 4px;
        padding: 16px;
        min-height: 380px;
      }
      
      .duty-time {
        font-size: 8px;
        padding: 1px 2px;
      }

      .card {
        padding: 16px;
        margin-bottom: 12px;
      }

      .logo-text h1 {
        font-size: 18px;
      }

      .logo-text .subtitle {
        font-size: 11px;
      }

      .date-number {
        width: 26px;
        height: 26px;
      }

      .calendar-date.today .date-number {
        width: 26px;
        height: 26px;
      }
    }

    @media (min-width: 769px) {
      .container {
        max-width: 900px;
        padding: 0 20px;
      }
      
      .desktop-only {
        display: block;
      }
      
      .mobile-actions {
        display: none;
      }
      
      .desktop-actions {
        display: flex;
      }
      
      .stats-grid {
        grid-template-columns: repeat(4, 1fr);
      }

      .theme-toggle {
        display: flex;
      }

      .calendar-grid {
        gap: 8px;
        padding: 24px;
        min-height: 480px;
      }

      .calendar-date {
        min-height: 65px;
        font-size: 15px;
        margin: 3px;
      }

      .date-number {
        width: 34px;
        height: 34px;
      }

      .calendar-date.today .date-number {
        width: 34px;
        height: 34px;
      }

      .stat-number {
        font-size: 20px;
      }

      .stat-label {
        font-size: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header fade-in">
      <div class="logo">
        <div class="logo-icon">
          <img src="image.jpg" alt="Duty Calendar Logo" onerror="this.parentElement.innerHTML='📅'">
        </div>
        <div class="logo-text">
          <h1>Duty Calendar</h1>
          <div class="subtitle">Professional Scheduling</div>
        </div>
      </div>
      
      <div class="header-actions">
        <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
          <span id="themeIcon">🌙</span>
          <span id="themeText">Dark</span>
        </button>
        
        <button class="menu-toggle" onclick="toggleMobileMenu()" aria-label="Menu">
          <span id="menuIcon">⚙️</span>
        </button>
      </div>
    </header>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu" onclick="closeMobileMenuOnBackdrop(event)">
      <div class="mobile-menu-content">
        <div class="mobile-menu-header">
          <div class="mobile-menu-title">Quick Actions & Settings</div>
          <button class="close-menu" onclick="toggleMobileMenu()" aria-label="Close menu">×</button>
        </div>
        
        <!-- Quick Add Duty in Mobile Menu -->
        <div class="card">
          <div class="card-header">
            <div class="card-icon">📋</div>
            <div>
              <div class="card-title">Quick Add Duty</div>
              <div class="card-description">Add duty for selected date</div>
            </div>
          </div>
          
          <div class="form-group">
            <label for="mobileDutyDate">📅 Select Date</label>
            <input type="date" id="mobileDutyDate" required>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="mobileStartTime">🕐 Start</label>
              <input type="time" id="mobileStartTime" value="08:00" required>
            </div>
            <div class="form-group">
              <label for="mobileEndTime">🕔 End</label>
              <input type="time" id="mobileEndTime" value="17:00" required>
            </div>
          </div>

          <div class="form-group">
            <label for="mobileDutyType">🏷️ Type</label>
            <select id="mobileDutyType">
              <option value="regular">Regular Duty</option>
              <option value="overtime">Overtime</option>
              <option value="emergency">Emergency</option>
              <option value="training">Training</option>
              <option value="meeting">Meeting</option>
            </select>
          </div>

          <div class="form-group">
            <label for="mobileDutyNotes">📝 Notes</label>
            <textarea id="mobileDutyNotes" rows="2" placeholder="Optional notes..."></textarea>
          </div>
          
          <div class="mobile-actions">
            <button class="btn btn-primary" onclick="addDutyMobile()" id="mobileAddBtn">
              <span>➕</span> Add Duty
            </button>
            <button class="btn btn-danger" onclick="removeDutyMobile()" id="mobileRemoveBtn">
              <span>🗑️</span> Remove
            </button>
          </div>
        </div>

        <!-- Smart Notifications in Mobile Menu -->
        <div class="card">
          <div class="card-header">
            <div class="card-icon">🔔</div>
            <div>
              <div class="card-title">Smart Notifications</div>
              <div class="card-description">Manage notification preferences</div>
            </div>
          </div>
          
          <div class="switch-container">
            <div class="switch-info">
              <div class="switch-title">Enable Notifications</div>
              <div class="switch-description">Receive alerts before duty starts</div>
            </div>
            <label class="switch">
              <input type="checkbox" id="mobileNotificationToggle" onchange="toggleNotification('enabled')">
              <span class="switch-slider"></span>
            </label>
          </div>

          <div class="switch-container">
            <div class="switch-info">
              <div class="switch-title">Daily Summary</div>
              <div class="switch-description">Get daily overview of duties</div>
            </div>
            <label class="switch">
              <input type="checkbox" id="mobileDailySummaryToggle" onchange="toggleNotification('dailySummary')">
              <span class="switch-slider"></span>
            </label>
          </div>

          <div class="switch-container">
            <div class="switch-info">
              <div class="switch-title">Overtime Alerts</div>
              <div class="switch-description">Alert for overtime limits</div>
            </div>
            <label class="switch">
              <input type="checkbox" id="mobileOvertimeToggle" onchange="toggleNotification('overtime')">
              <span class="switch-slider"></span>
            </label>
          </div>
        </div>

        <!-- Other Actions -->
        <div class="menu-actions">
          <button class="btn btn-secondary" onclick="showStats(); toggleMobileMenu();">
            <span>📊</span> View Analytics
          </button>
          <button class="btn btn-outline" onclick="exportToPDF(); toggleMobileMenu();">
            <span>📄</span> Export PDF
          </button>
          <button class="btn btn-outline" onclick="toggleTheme();">
            <span id="mobileThemeIcon">🌙</span> <span id="mobileThemeText">Toggle Theme</span>
          </button>
        </div>
      </div>
    </div>

    <main>
      <!-- Stats Grid - Smaller -->
      <div class="stats-grid fade-in">
        <div class="stat-card">
          <div class="stat-number" id="totalDuties">0</div>
          <div class="stat-label">Total Duties</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="monthDuties">0</div>
          <div class="stat-label">This Month</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="nextDuty">--</div>
          <div class="stat-label">Next Duty</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="avgHours">0</div>
          <div class="stat-label">Avg Hours</div>
        </div>
      </div>

      <!-- Desktop Duty Management (Hidden on Mobile) -->
      <div class="card fade-in desktop-only">
        <div class="card-header">
          <div class="card-icon">📋</div>
          <div>
            <div class="card-title">Duty Management</div>
            <div class="card-description">Schedule and manage your duty assignments</div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="dutyDate">📅 Select Date</label>
          <input type="date" id="dutyDate" required>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="startTime">🕐 Start Time</label>
            <input type="time" id="startTime" value="08:00" required>
          </div>
          <div class="form-group">
            <label for="endTime">🕔 End Time</label>
            <input type="time" id="endTime" value="17:00" required>
          </div>
        </div>

        <div class="form-group">
          <label for="dutyType">🏷️ Duty Type</label>
          <select id="dutyType">
            <option value="regular">Regular Duty</option>
            <option value="overtime">Overtime</option>
            <option value="emergency">Emergency</option>
            <option value="training">Training</option>
            <option value="meeting">Meeting</option>
          </select>
        </div>

        <div class="form-group">
          <label for="dutyNotes">📝 Notes (Optional)</label>
          <textarea id="dutyNotes" rows="2" placeholder="Add any additional notes..."></textarea>
        </div>
        
        <div class="desktop-actions">
          <button class="btn btn-primary" onclick="addDuty()" id="addBtn">
            <span>➕</span> Add Duty
          </button>
          <button class="btn btn-danger" onclick="removeDuty()" id="removeBtn">
            <span>🗑️</span> Remove
          </button>
        </div>
      </div>

      <!-- Desktop Smart Notifications (Hidden on Mobile) -->
      <div class="card fade-in desktop-only">
        <div class="card-header">
          <div class="card-icon">🔔</div>
          <div>
            <div class="card-title">Smart Notifications</div>
            <div class="card-description">Get intelligent reminders for your duties</div>
          </div>
        </div>
        
        <div class="switch-container">
          <div class="switch-info">
            <div class="switch-title">Enable Notifications</div>
            <div class="switch-description">Receive alerts before duty starts</div>
          </div>
          <label class="switch">
            <input type="checkbox" id="notificationToggle" onchange="toggleNotification('enabled')">
            <span class="switch-slider"></span>
          </label>
        </div>

        <div class="switch-container">
          <div class="switch-info">
            <div class="switch-title">Daily Summary</div>
            <div class="switch-description">Get daily overview of upcoming duties</div>
          </div>
          <label class="switch">
            <input type="checkbox" id="dailySummaryToggle" onchange="toggleNotification('dailySummary')">
            <span class="switch-slider"></span>
          </label>
        </div>

        <div class="switch-container">
          <div class="switch-info">
            <div class="switch-title">Overtime Alerts</div>
            <div class="switch-description">Alert when approaching overtime limits</div>
          </div>
          <label class="switch">
            <input type="checkbox" id="overtimeToggle" onchange="toggleNotification('overtime')">
            <span class="switch-slider"></span>
          </label>
        </div>
      </div>

      <!-- Calendar (Always Visible) - Increased height with better spacing -->
      <div class="card fade-in">
        <div class="card-header">
          <div class="card-icon">📆</div>
          <div>
            <div class="card-title">Duty Calendar</div>
            <div class="card-description">Visual overview of all your scheduled duties</div>
          </div>
        </div>

        <div class="calendar-container">
          <div class="calendar-header">
            <button class="calendar-nav-btn" onclick="changeMonth(-1)" aria-label="Previous month">‹</button>
            <div class="calendar-title" id="calendarTitle">December 2024</div>
            <button class="calendar-nav-btn" onclick="changeMonth(1)" aria-label="Next month">›</button>
          </div>

          <div class="calendar-grid" id="calendarGrid"></div>
        </div>
      </div>
    </main>
  </div>

  <!-- Notification -->
  <div class="notification" id="notification">
    <div style="display: flex; justify-content: space-between; align-items: start;">
      <div>
        <h4 id="notificationTitle" style="font-weight: 600; margin-bottom: 4px;"></h4>
        <p id="notificationMessage" style="font-size: 14px; color: var(--text-secondary);"></p>
      </div>
      <button onclick="hideNotification()" style="background: none; border: none; color: var(--text-secondary); font-size: 18px; cursor: pointer; margin-left: 16px;">×</button>
    </div>
  </div>

  <script>
    // Global variables
    let duties = JSON.parse(localStorage.getItem('duties')) || [];
    let currentMonth = new Date();
    let selectedDate = getCurrentDate();
    let notificationSettings = JSON.parse(localStorage.getItem('notificationSettings')) || {
      enabled: false,
      dailySummary: false,
      overtime: false
    };
    let notificationTimeouts = {};
    
    // Touch swipe variables
    let touchStartX = 0;
    let touchEndX = 0;

    // Utility functions
    function getCurrentDate() {
      return new Date().toISOString().split('T')[0];
    }

    function formatDate(dateStr) {
      return new Date(dateStr).toLocaleDateString();
    }

    function formatTime(timeStr) {
      return new Date(`2000-01-01T${timeStr}`).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }

    function generateId() {
      return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }

    // Local Storage functions
    function saveDuties() {
      localStorage.setItem('duties', JSON.stringify(duties));
      updateStats();
      scheduleAllNotifications();
    }

    function saveNotificationSettings() {
      localStorage.setItem('notificationSettings', JSON.stringify(notificationSettings));
      if (notificationSettings.enabled) {
        scheduleAllNotifications();
      } else {
        clearAllNotifications();
      }
    }

    // Enhanced notification system for mobile
    function showNotification(title, message, type = 'info') {
      const notification = document.getElementById('notification');
      const titleEl = document.getElementById('notificationTitle');
      const messageEl = document.getElementById('notificationMessage');
      
      titleEl.textContent = title;
      messageEl.textContent = message;
      
      notification.className = `notification ${type} show`;
      
      // For mobile devices, also try to show browser notification
      if ('Notification' in window && notificationSettings.enabled) {
        requestNotificationPermission().then(permission => {
          if (permission === 'granted') {
            const options = {
              body: message,
              icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">📋</text></svg>',
              badge: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">📋</text></svg>',
              vibrate: [200, 100, 200] // Vibration pattern for mobile devices
            };
            
            // Show notification
            new Notification(title, options);
            
            // Play sound if possible
            if (typeof Audio !== 'undefined') {
              const audio = new Audio('data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU...');
              audio.play().catch(e => console.log('Audio play failed:', e));
            }
          }
        });
      }
      
      setTimeout(() => {
        hideNotification();
      }, 5000);
    }

    function hideNotification() {
      const notification = document.getElementById('notification');
      notification.classList.remove('show');
    }

    // Request notification permission
    async function requestNotificationPermission() {
      if ('Notification' in window) {
        try {
          const permission = await Notification.requestPermission();
          return permission;
        } catch (e) {
          console.error('Notification permission error:', e);
          return 'denied';
        }
      }
      return 'denied';
    }

    // Schedule notifications for all duties
    function scheduleAllNotifications() {
      if (!notificationSettings.enabled) return;
      
      // Clear any existing notifications
      clearAllNotifications();
      
      const now = new Date();
      
      duties.forEach(duty => {
        const dutyDate = new Date(duty.date);
        const dutyDateTime = new Date(`${duty.date}T${duty.startTime}`);
        
        // Only schedule notifications for future duties
        if (dutyDateTime > now) {
          // Schedule 1 day before notification
          const oneDayBefore = new Date(dutyDateTime);
          oneDayBefore.setDate(oneDayBefore.getDate() - 1);
          
          if (oneDayBefore > now) {
            const timeoutId = setTimeout(() => {
              showNotification(
                'Upcoming Duty Tomorrow', 
                `You have a ${duty.type} duty scheduled for tomorrow at ${formatTime(duty.startTime)}`,
                'warning'
              );
            }, oneDayBefore - now);
            
            notificationTimeouts[`${duty.id}-1day`] = timeoutId;
          }
          
          // Schedule 1 hour before notification
          const oneHourBefore = new Date(dutyDateTime);
          oneHourBefore.setHours(oneHourBefore.getHours() - 1);
          
          if (oneHourBefore > now) {
            const timeoutId = setTimeout(() => {
              showNotification(
                'Upcoming Duty in 1 Hour', 
                `Your ${duty.type} duty starts at ${formatTime(duty.startTime)}`,
                'warning'
              );
            }, oneHourBefore - now);
            
            notificationTimeouts[`${duty.id}-1hour`] = timeoutId;
          }
          
          // Schedule 30 minutes before notification
          const thirtyMinutesBefore = new Date(dutyDateTime);
          thirtyMinutesBefore.setMinutes(thirtyMinutesBefore.getMinutes() - 30);
          
          if (thirtyMinutesBefore > now) {
            const timeoutId = setTimeout(() => {
              showNotification(
                'Upcoming Duty in 30 Minutes', 
                `Your ${duty.type} duty starts soon at ${formatTime(duty.startTime)}`,
                'warning'
              );
            }, thirtyMinutesBefore - now);
            
            notificationTimeouts[`${duty.id}-30min`] = timeoutId;
          }
        }
      });
    }

    // Clear all scheduled notifications
    function clearAllNotifications() {
      Object.keys(notificationTimeouts).forEach(key => {
        clearTimeout(notificationTimeouts[key]);
      });
      notificationTimeouts = {};
    }

    // Mobile menu functions
    function toggleMobileMenu() {
      const menu = document.getElementById('mobileMenu');
      menu.classList.toggle('active');
      
      // Update mobile form with selected date
      document.getElementById('mobileDutyDate').value = selectedDate;
    }

    function closeMobileMenuOnBackdrop(event) {
      if (event.target === event.currentTarget) {
        toggleMobileMenu();
      }
    }

    // Theme functions
    function toggleTheme() {
      document.body.classList.toggle('dark');
      const isDark = document.body.classList.contains('dark');
      
      // Update theme icons
      const themeIcon = document.getElementById('themeIcon');
      const themeText = document.getElementById('themeText');
      const mobileThemeIcon = document.getElementById('mobileThemeIcon');
      const mobileThemeText = document.getElementById('mobileThemeText');
      
      if (isDark) {
        themeIcon.textContent = '☀️';
        themeText.textContent = 'Light';
        mobileThemeIcon.textContent = '☀️';
        mobileThemeText.textContent = 'Light Mode';
      } else {
        themeIcon.textContent = '🌙';
        themeText.textContent = 'Dark';
        mobileThemeIcon.textContent = '🌙';
        mobileThemeText.textContent = 'Dark Mode';
      }
      
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    }

    // Notification settings
    function toggleNotification(type) {
      notificationSettings[type] = !notificationSettings[type];
      saveNotificationSettings();
      
      // Sync with mobile toggles
      const desktopToggle = document.getElementById(`${type === 'enabled' ? 'notification' : type === 'dailySummary' ? 'dailySummary' : 'overtime'}Toggle`);
      const mobileToggle = document.getElementById(`mobile${type === 'enabled' ? 'Notification' : type === 'dailySummary' ? 'DailySummary' : 'Overtime'}Toggle`);
      
      if (desktopToggle) desktopToggle.checked = notificationSettings[type];
      if (mobileToggle) mobileToggle.checked = notificationSettings[type];
      
      if (type === 'enabled' && notificationSettings[type]) {
        requestNotificationPermission().then(() => {
          showNotification(
            'Notifications Enabled',
            'You will now receive reminders before your duties start',
            'success'
          );
          scheduleAllNotifications();
        });
      } else if (type === 'enabled' && !notificationSettings[type]) {
        clearAllNotifications();
        showNotification(
          'Notifications Disabled',
          'You will no longer receive duty reminders',
          'info'
        );
      } else {
        showNotification(
          'Settings Updated',
          `${type === 'dailySummary' ? 'Daily Summary' : 'Overtime Alerts'} ${notificationSettings[type] ? 'enabled' : 'disabled'}`,
          'success'
        );
      }
    }

    // Duty management functions
    function addDuty() {
      const date = document.getElementById('dutyDate').value;
      const startTime = document.getElementById('startTime').value;
      const endTime = document.getElementById('endTime').value;
      const type = document.getElementById('dutyType').value;
      const notes = document.getElementById('dutyNotes').value;

      if (!date || !startTime || !endTime) {
        showNotification('Error', 'Please fill in all required fields', 'error');
        return;
      }

      // Check if duty already exists for this date
      const existingDuty = duties.find(duty => duty.date === date);
      if (existingDuty) {
        showNotification('Error', 'Duty already exists for this date', 'error');
        return;
      }

      const newDuty = {
        id: generateId(),
        date,
        startTime,
        endTime,
        type,
        notes,
        createdAt: new Date().toISOString()
      };

      duties.push(newDuty);
      saveDuties();
      renderCalendar();
      
      // Clear form
      document.getElementById('dutyDate').value = getCurrentDate();
      document.getElementById('startTime').value = '08:00';
      document.getElementById('endTime').value = '17:00';
      document.getElementById('dutyType').value = 'regular';
      document.getElementById('dutyNotes').value = '';

      showNotification('Success', 'Duty added successfully', 'success');
    }

    function addDutyMobile() {
      const date = document.getElementById('mobileDutyDate').value;
      const startTime = document.getElementById('mobileStartTime').value;
      const endTime = document.getElementById('mobileEndTime').value;
      const type = document.getElementById('mobileDutyType').value;
      const notes = document.getElementById('mobileDutyNotes').value;

      if (!date || !startTime || !endTime) {
        showNotification('Error', 'Please fill in all required fields', 'error');
        return;
      }

      // Check if duty already exists for this date
      const existingDuty = duties.find(duty => duty.date === date);
      if (existingDuty) {
        showNotification('Error', 'Duty already exists for this date', 'error');
        return;
      }

      const newDuty = {
        id: generateId(),
        date,
        startTime,
        endTime,
        type,
        notes,
        createdAt: new Date().toISOString()
      };

      duties.push(newDuty);
      saveDuties();
      renderCalendar();
      
      // Clear mobile form
      document.getElementById('mobileDutyDate').value = getCurrentDate();
      document.getElementById('mobileStartTime').value = '08:00';
      document.getElementById('mobileEndTime').value = '17:00';
      document.getElementById('mobileDutyType').value = 'regular';
      document.getElementById('mobileDutyNotes').value = '';

      showNotification('Success', 'Duty added successfully', 'success');
      toggleMobileMenu();
    }

    function removeDuty() {
      const date = document.getElementById('dutyDate').value;
      if (!date) {
        showNotification('Error', 'Please select a date', 'error');
        return;
      }

      const dutyIndex = duties.findIndex(duty => duty.date === date);
      if (dutyIndex === -1) {
        showNotification('Error', 'No duty found for selected date', 'error');
        return;
      }

      // Clear any notifications for this duty
      clearDutyNotifications(duties[dutyIndex].id);
      
      duties.splice(dutyIndex, 1);
      saveDuties();
      renderCalendar();
      showNotification('Success', 'Duty removed successfully', 'success');
    }

    function removeDutyMobile() {
      const date = document.getElementById('mobileDutyDate').value;
      if (!date) {
        showNotification('Error', 'Please select a date', 'error');
        return;
      }

      const dutyIndex = duties.findIndex(duty => duty.date === date);
      if (dutyIndex === -1) {
        showNotification('Error', 'No duty found for selected date', 'error');
        return;
      }

      // Clear any notifications for this duty
      clearDutyNotifications(duties[dutyIndex].id);
      
      duties.splice(dutyIndex, 1);
      saveDuties();
      renderCalendar();
      showNotification('Success', 'Duty removed successfully', 'success');
      toggleMobileMenu();
    }

    // Clear notifications for a specific duty
    function clearDutyNotifications(dutyId) {
      ['1day', '1hour', '30min'].forEach(period => {
        const key = `${dutyId}-${period}`;
        if (notificationTimeouts[key]) {
          clearTimeout(notificationTimeouts[key]);
          delete notificationTimeouts[key];
        }
      });
    }

    // Calendar functions
    function changeMonth(direction) {
      currentMonth.setMonth(currentMonth.getMonth() + direction);
      renderCalendar();
    }

    function handleDateClick(dateStr) {
      selectedDate = dateStr;
      
      // Update form dates
      document.getElementById('dutyDate').value = dateStr;
      document.getElementById('mobileDutyDate').value = dateStr;
      
      // Show duty info if exists
      const duty = duties.find(d => d.date === dateStr);
      if (duty) {
        showNotification(
          'Duty Info',
          `${duty.type.charAt(0).toUpperCase() + duty.type.slice(1)} duty from ${duty.startTime} to ${duty.endTime}`,
          'info'
        );
      }
    }

    function renderCalendar() {
      const calendar = document.getElementById('calendarGrid');
      const title = document.getElementById('calendarTitle');
      
      const year = currentMonth.getFullYear();
      const month = currentMonth.getMonth();
      
      const monthNames = [
        'January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'
      ];
      
      title.textContent = `${monthNames[month]} ${year}`;
      
      // Clear calendar
      calendar.innerHTML = '';
      
      // Day names - Monday to Sunday
      const dayNames = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
      dayNames.forEach(day => {
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day-name';
        dayElement.textContent = day;
        calendar.appendChild(dayElement);
      });
      
      // Get first day of month (0 = Sunday, 1 = Monday, etc.)
      const firstDay = new Date(year, month, 1).getDay();
      // Convert to Monday = 0, Tuesday = 1, etc.
      const mondayFirstDay = (firstDay === 0) ? 6 : firstDay - 1;
      
      // Get number of days in month
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      
      // Add empty cells for days before the first day of the month
      for (let i = 0; i < mondayFirstDay; i++) {
        const emptyElement = document.createElement('div');
        emptyElement.className = 'calendar-date other-month';
        calendar.appendChild(emptyElement);
      }
      
      // Add days of the month
      const today = getCurrentDate();
      
      for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const duty = duties.find(d => d.date === dateStr);
        
        const dateElement = document.createElement('div');
        let classes = 'calendar-date';
        
        if (dateStr === today) {
          classes += ' today';
        }
        
        if (duty) {
          classes += ' duty';
        }
        
        dateElement.className = classes;
        dateElement.onclick = () => handleDateClick(dateStr);
        
        const dateNumber = document.createElement('div');
        dateNumber.className = 'date-number';
        dateNumber.textContent = day;
        dateElement.appendChild(dateNumber);
        
        if (duty) {
          const dutyTime = document.createElement('div');
          dutyTime.className = 'duty-time';
          dutyTime.textContent = duty.startTime;
          dateElement.appendChild(dutyTime);
        }
        
        calendar.appendChild(dateElement);
      }
    }

    // Stats functions
    function updateStats() {
      const currentDate = new Date();
      const currentMonthDuties = duties.filter(duty => {
        const dutyDate = new Date(duty.date);
        return dutyDate.getMonth() === currentDate.getMonth() && 
               dutyDate.getFullYear() === currentDate.getFullYear();
      });

      const futureDuties = duties.filter(duty => new Date(duty.date) > currentDate);
      const nextDuty = futureDuties.length > 0 ? 
        formatDate(futureDuties.sort((a, b) => new Date(a.date) - new Date(b.date))[0].date) : '--';

      const totalHours = duties.reduce((sum, duty) => {
        const start = new Date(`2000-01-01T${duty.startTime}`);
        const end = new Date(`2000-01-01T${duty.endTime}`);
        const hours = (end - start) / (1000 * 60 * 60);
        return sum + (hours > 0 ? hours : 0);
      }, 0);

      const avgHours = duties.length > 0 ? Math.round(totalHours / duties.length) : 0;

      document.getElementById('totalDuties').textContent = duties.length;
      document.getElementById('monthDuties').textContent = currentMonthDuties.length;
      document.getElementById('nextDuty').textContent = nextDuty;
      document.getElementById('avgHours').textContent = avgHours;
    }

    function showStats() {
      const stats = `
        Total Duties: ${duties.length}
        This Month: ${duties.filter(duty => {
          const dutyDate = new Date(duty.date);
          const now = new Date();
          return dutyDate.getMonth() === now.getMonth() && dutyDate.getFullYear() === now.getFullYear();
        }).length}
        
        Upcoming Duties: ${duties.filter(duty => new Date(duty.date) > new Date()).length}
        
        Most Common Type: ${getMostCommonDutyType()}
      `;
      
      showNotification('Analytics', stats, 'info');
    }

    function getMostCommonDutyType() {
      if (duties.length === 0) return 'None';
      
      const types = {};
      duties.forEach(duty => {
        types[duty.type] = (types[duty.type] || 0) + 1;
      });
      
      return Object.keys(types).reduce((a, b) => types[a] > types[b] ? a : b);
    }

    function exportToPDF() {
      // Initialize jsPDF
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({
        orientation: 'portrait',
        unit: 'mm',
        format: 'a4'
      });
      
      // Add title with logo
      doc.setFontSize(22);
      doc.setTextColor(40);
      doc.setFont('helvetica', 'bold');
      doc.text('Duty Calendar Report', 105, 20, { align: 'center' });
      
      // Add decorative line
      doc.setDrawColor(59, 130, 246);
      doc.setLineWidth(0.5);
      doc.line(30, 25, 180, 25);
      
      // Add date
      doc.setFontSize(12);
      doc.setTextColor(100);
      doc.setFont('helvetica', 'normal');
      doc.text(`Generated on: ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}`, 105, 32, { align: 'center' });
      
      // Add summary stats section
      doc.setFontSize(16);
      doc.setTextColor(40);
      doc.setFont('helvetica', 'bold');
      doc.text('Summary Statistics', 20, 45);
      
      // Add summary box
      doc.setFillColor(240, 240, 240);
      doc.roundedRect(20, 50, 170, 30, 3, 3, 'F');
      
      const totalDuties = duties.length;
      const currentMonthDuties = duties.filter(duty => {
        const dutyDate = new Date(duty.date);
        return dutyDate.getMonth() === currentMonth.getMonth() && 
               dutyDate.getFullYear() === currentMonth.getFullYear();
      }).length;
      
      const futureDuties = duties.filter(duty => new Date(duty.date) > new Date());
      const nextDuty = futureDuties.length > 0 ? 
        formatDate(futureDuties.sort((a, b) => new Date(a.date) - new Date(b.date))[0].date) : 'None';
      
      const totalHours = duties.reduce((sum, duty) => {
        const start = new Date(`2000-01-01T${duty.startTime}`);
        const end = new Date(`2000-01-01T${duty.endTime}`);
        const hours = (end - start) / (1000 * 60 * 60);
        return sum + (hours > 0 ? hours : 0);
      }, 0);
      
      const avgHours = duties.length > 0 ? Math.round(totalHours / duties.length) : 0;
      
      doc.setFontSize(12);
      doc.setTextColor(40);
      doc.setFont('helvetica', 'normal');
      doc.text(`Total Duties: ${totalDuties}`, 30, 60);
      doc.text(`This Month: ${currentMonthDuties}`, 30, 70);
      doc.text(`Next Duty: ${nextDuty}`, 100, 60);
      doc.text(`Average Hours: ${avgHours}`, 100, 70);
      
      // Add calendar month view section
      doc.addPage();
      doc.setFontSize(16);
      doc.setTextColor(40);
      doc.setFont('helvetica', 'bold');
      doc.text(`Calendar: ${document.getElementById('calendarTitle').textContent}`, 105, 20, { align: 'center' });
      
      // Create calendar table
      const year = currentMonth.getFullYear();
      const month = currentMonth.getMonth();
      const firstDay = new Date(year, month, 1).getDay();
      const mondayFirstDay = (firstDay === 0) ? 6 : firstDay - 1;
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      
      const dayNames = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
      const calendarData = [];
      
      // Add empty cells for days before the first day of the month
      let currentRow = Array(7).fill('');
      
      // Add days of the month
      for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const duty = duties.find(d => d.date === dateStr);
        
        const dayOfWeek = new Date(dateStr).getDay();
        const adjustedDayOfWeek = dayOfWeek === 0 ? 6 : dayOfWeek - 1; // Monday = 0
        
        if (day === 1) {
          // Fill the beginning of the first row with empty cells
          for (let i = 0; i < mondayFirstDay; i++) {
            currentRow[i] = '';
          }
        }
        
        currentRow[adjustedDayOfWeek] = {
          content: day.toString(),
          styles: {
            fillColor: duty ? [220, 255, 220] : [255, 255, 255],
            textColor: duty ? [0, 100, 0] : [0, 0, 0],
            fontStyle: dateStr === getCurrentDate() ? 'bold' : 'normal',
            cellPadding: 5
          }
        };
        
        if (adjustedDayOfWeek === 6 || day === daysInMonth) {
          calendarData.push([...currentRow]);
          currentRow = Array(7).fill('');
        }
      }
      
      // Create the calendar table
      doc.autoTable({
        head: [dayNames],
        body: calendarData,
        startY: 30,
        styles: {
          halign: 'center',
          valign: 'middle',
          cellPadding: 5
        },
        headStyles: {
          fillColor: [59, 130, 246],
          textColor: [255, 255, 255],
          fontStyle: 'bold',
          halign: 'center'
        },
        columnStyles: {
          0: { cellWidth: 'auto' },
          1: { cellWidth: 'auto' },
          2: { cellWidth: 'auto' },
          3: { cellWidth: 'auto' },
          4: { cellWidth: 'auto' },
          5: { cellWidth: 'auto' },
          6: { cellWidth: 'auto' }
        },
        didDrawCell: (data) => {
          // Add duty indicator
          if (data.cell.raw && typeof data.cell.raw === 'object' && data.cell.raw.content) {
            const day = parseInt(data.cell.raw.content);
            const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const duty = duties.find(d => d.date === dateStr);
            
            if (duty) {
              doc.setFontSize(8);
              doc.setTextColor(0, 100, 0);
              doc.text(duty.startTime, data.cell.x + data.cell.width / 2, data.cell.y + data.cell.height - 5, {
                align: 'center'
              });
            }
          }
        }
      });
      
      // Add duties list section
      doc.addPage();
      doc.setFontSize(16);
      doc.setTextColor(40);
      doc.setFont('helvetica', 'bold');
      doc.text('All Scheduled Duties', 105, 20, { align: 'center' });
      
      if (duties.length === 0) {
        doc.setFontSize(12);
        doc.setTextColor(100);
        doc.setFont('helvetica', 'normal');
        doc.text('No duties scheduled', 105, 30, { align: 'center' });
      } else {
        const dutiesData = duties.map(duty => [
          formatDate(duty.date),
          duty.startTime,
          duty.endTime,
          duty.type.charAt(0).toUpperCase() + duty.type.slice(1),
          duty.notes || '-'
        ]);
        
        doc.autoTable({
          head: [['Date', 'Start', 'End', 'Type', 'Notes']],
          body: dutiesData,
          startY: 30,
          styles: {
            fontSize: 10,
            cellPadding: 4,
            overflow: 'linebreak',
            valign: 'middle'
          },
          columnStyles: {
            0: { cellWidth: 25, halign: 'center' },
            1: { cellWidth: 20, halign: 'center' },
            2: { cellWidth: 20, halign: 'center' },
            3: { cellWidth: 25, halign: 'center' },
            4: { cellWidth: 'auto', halign: 'left' }
          },
          headStyles: {
            fillColor: [59, 130, 246],
            textColor: [255, 255, 255],
            fontStyle: 'bold',
            halign: 'center'
          },
          alternateRowStyles: {
            fillColor: [240, 240, 240]
          },
          margin: { top: 10 }
        });
      }
      
      // Add footer to each page
      const pageCount = doc.internal.getNumberOfPages();
      for (let i = 1; i <= pageCount; i++) {
        doc.setPage(i);
        doc.setFontSize(10);
        doc.setTextColor(150);
        doc.text(`Page ${i} of ${pageCount}`, 105, 287, { align: 'center' });
        doc.text('Duty Calendar - Professional Scheduling', 20, 287);
        doc.text(new Date().toLocaleDateString(), 190, 287, { align: 'right' });
      }
      
      // Save the PDF
      const fileName = `DutyCalendar_${new Date().toISOString().slice(0, 10)}.pdf`;
      doc.save(fileName);
      
      showNotification('Export Successful', `PDF "${fileName}" has been generated and downloaded`, 'success');
    }

    // Touch swipe functions
    function handleTouchStart(e) {
      touchStartX = e.changedTouches[0].screenX;
    }
    
    function handleTouchEnd(e) {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    }
    
    function handleSwipe() {
      const threshold = 50; // Minimum swipe distance to trigger month change
      const diff = touchEndX - touchStartX;
      
      if (Math.abs(diff) > threshold) {
        if (diff > 0) {
          // Swipe right - previous month
          changeMonth(-1);
        } else {
          // Swipe left - next month
          changeMonth(1);
        }
      }
    }

    // Initialize app
    function initializeApp() {
      // Set current date
      selectedDate = getCurrentDate();
      document.getElementById('dutyDate').value = selectedDate;
      document.getElementById('mobileDutyDate').value = selectedDate;
      
      // Load theme
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        document.body.classList.add('dark');
        document.getElementById('themeIcon').textContent = '☀️';
        document.getElementById('themeText').textContent = 'Light';
        document.getElementById('mobileThemeIcon').textContent = '☀️';
        document.getElementById('mobileThemeText').textContent = 'Light Mode';
      }
      
      // Load notification settings
      document.getElementById('notificationToggle').checked = notificationSettings.enabled;
      document.getElementById('dailySummaryToggle').checked = notificationSettings.dailySummary;
      document.getElementById('overtimeToggle').checked = notificationSettings.overtime;
      document.getElementById('mobileNotificationToggle').checked = notificationSettings.enabled;
      document.getElementById('mobileDailySummaryToggle').checked = notificationSettings.dailySummary;
      document.getElementById('mobileOvertimeToggle').checked = notificationSettings.overtime;
      
      // Add touch event listeners for swipe
      const calendarGrid = document.getElementById('calendarGrid');
      calendarGrid.addEventListener('touchstart', handleTouchStart, false);
      calendarGrid.addEventListener('touchend', handleTouchEnd, false);
      
      // Render calendar and update stats
      renderCalendar();
      updateStats();
      
      // Request notification permission if enabled
      if (notificationSettings.enabled) {
        requestNotificationPermission().then(() => {
          scheduleAllNotifications();
        });
      }
      
      // Check for notifications on page load
      checkImmediateNotifications();
    }

    // Check for notifications that should trigger immediately
    function checkImmediateNotifications() {
      if (!notificationSettings.enabled) return;
      
      const now = new Date();
      const oneDay = 24 * 60 * 60 * 1000; // 1 day in milliseconds
      
      duties.forEach(duty => {
        const dutyDateTime = new Date(`${duty.date}T${duty.startTime}`);
        const timeDiff = dutyDateTime - now;
        
        // If duty is within the next 5 minutes
        if (timeDiff > 0 && timeDiff < 5 * 60 * 1000) {
          showNotification(
            'Duty Starting Soon', 
            `Your ${duty.type} duty starts in ${Math.round(timeDiff / (60 * 1000))} minutes at ${formatTime(duty.startTime)}`,
            'warning'
          );
        }
      });
    }

    // Start the app
    document.addEventListener('DOMContentLoaded', initializeApp);
  </script>
<!-- Add this just before the closing body tag -->
<!-- Add this just before the closing </body> tag -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8530386402467587"
     crossorigin="anonymous"></script>
<!-- banner -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-8530386402467587"
     data-ad-slot="5226962208"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>




 
<script type='text/javascript' src='//encouragingbrightest.com/4c/5f/40/4c5f40aa163e001638b18fcb88cc90e4.js'></script>
  
</body>
</html>





